<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="VoyagerHackathon">
<title>Intro to R package development • VoyagerHackathon</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Intro to R package development">
<meta property="og:description" content="VoyagerHackathon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">VoyagerHackathon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/info.html">Event info</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-workshop">Workshop</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-workshop">
    <a class="dropdown-item" href="../articles/sfe.html">SFE</a>
    <a class="dropdown-item" href="../articles/voyager.html">Voyager</a>
    <a class="dropdown-item" href="../articles/package.html">R package dev</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lambdamoses/VoyagerHackathon/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Intro to R package development</h1>
                        <h4 data-toc-skip class="author">Lambda
Moses</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:dlu2@caltech.edu" class="email">dlu2@caltech.edu</a>
      
                  
            <h4 data-toc-skip class="date">2024-03-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lambdamoses/VoyagerHackathon/blob/HEAD/vignettes/package.Rmd" class="external-link"><code>vignettes/package.Rmd</code></a></small>
      <div class="d-none name"><code>package.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h3>
<p>The freely available resources below may be helpful for participating
in the hackathon:</p>
<ul>
<li>
<a href="https://r-pkgs.org/" class="external-link">R Packages</a>: Please read if you
don’t have prior experiences writing R packages. You will learn about
the structure of R packages and how to write documentation and unit
tests.</li>
<li>
<a href="https://adv-r.hadley.nz/" class="external-link">Advanced R</a>: This book will
give intermediate R users a more in depth understanding of the R
language. Please read if you want to tackle issues marked as “advanced”,
which may involve S4 classes and functional programming.</li>
<li>
<a href="https://contributions.bioconductor.org/index.html" class="external-link">Bioconductor
developer guide</a>: Explains in details the requirements for
Bioconductor packages. The R Packages book explains CRAN requirements,
but Bioconductor has different and often more stringent
requirements.</li>
<li>
<a href="https://ggplot2.tidyverse.org/articles/extending-ggplot2.html" class="external-link">Extending
<code>ggplot2</code></a>: Advanced <code>ggplot2</code> topic relevant
to plotting the image behind geometries in <code>Voyager</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="system-setup">System setup<a class="anchor" aria-label="anchor" href="#system-setup"></a>
</h3>
<p>In order to participate in the hackathon, you need to have a <a href="https://github.com/" class="external-link">GitHub account</a> and <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" class="external-link">have
<code>git</code> installed</a> on your computer. If you haven’t used
<code>git</code> before, read <a href="https://git-scm.com/book/en/v2/Git-Basics-Getting-a-Git-Repository" class="external-link">the
Git Basics chapter</a> to get started. RStudio has a GUI for
<code>git</code> to make things easier, which is by default in the upper
right panel if the R project of interest is version controlled with
<code>git</code>. Version control helps you to keep track of changes in
your code and to merge contributions from collaborators.</p>
<p>You also need to <a href="https://contributions.bioconductor.org/use-devel.html" class="external-link">install the
devel version of R (4.4.0)</a> and <a href="https://posit.co/download/rstudio-desktop/" class="external-link">the RStudio IDE</a>.
Devel version of R because Bioconductor releases are tied to R versions.
Bioconductor has two releases every year, synced with the R release
schedule, one in late April, and the other in late October. The April
release corresponds to a a bump in the minor version in R (e.g. going
from 4.3.x to 4.4.0). R packages installed for one minor version of R
are incompatible with a different minor version (e.g. packages installed
under R 4.3.0 will still work with 4.3.1, but will not work with 4.2.x
or 4.4.0). If you use one package in a given Bioconductor release (3.19
is the upcoming one this April), then you must use other package in the
same release as well. This is so that users have a 6 month period of
relative stability. Developers should introduce breaking changes and
experimental features in the devel version (3.19 as of writing as 3.18
is the current release), so the changes don’t immediately break users’
code. This is why the hackathon uses the devel version.</p>
<p>Moreover, you can install previous versions of Bioconductor, with the
corresponding versions of R, to go back in time to reproduce analyses
with old package versions. Because all Bioconductor packages used must
be from the same Bioconductor release and the packages have been checked
within the same release, newer breaking changes in dependencies
introduced after this release should not break old code, thus providing
some backward compatibility. However, this is not perfect, since CRAN
and GitHub only packages don’t have this release schedule, but it’s
possible and not difficult to install old versions of CRAN packages. Git
version control also makes it possible and not difficult to install old
versions of GitHub only packages.</p>
<p>The <a href="https://www.freecodecamp.org/news/install-xcode-command-line-tools/" class="external-link">Xcode
Command Line Tools</a> are required for Mac users and <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link"><code>Rtools</code></a>
for Windows users if you need to compile dependencies of SFE and Voyager
from source, particularly the <code>sf</code> package which has several
system dependencies. See instructions to install system dependencies of
<code>sf</code> <a href="https://r-spatial.github.io/sf/" class="external-link">here</a>.
Binaries are available for Windows and Mac so compilation might not be
necessary.</p>
<p>Next <code>git clone</code> the repository of interest (Run on the
command line (Terminal on Mac and something like Git Bash or PowerShell
on Windows; RStudio also has a Terminal pane which is by default in the
bottom left), not R console):</p>
<pre><code># SFE
git clone https://github.com/pachterlab/SpatialFeatureExperiment.git

# Voyager
git clone https://github.com/pachterlab/voyager.git</code></pre>
<p>This will create a directory <code>SpatialFeatureExperiment</code> or
<code>Voyager</code> where the source code of the package is located.
Then in RStudio, <a href="https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects" class="external-link">create
a project</a>, choose Existing Directory, navigate to the
<code>SpatialFeatureExperiment</code> or <code>Voyager</code> directory,
and RStudio will open the project.</p>
<p>Next, in RStudio, in the R console, install <a href="https://devtools.r-lib.org/" class="external-link"><code>devtools</code></a> (makes it
easier to build, install, and test packages in development), <a href="https://roxygen2.r-lib.org/" class="external-link"><code>roxygen2</code></a> (to
generate documentation pages), <a href="https://usethis.r-lib.org/" class="external-link"><code>usethis</code></a> (makes it
easier to add unit tests and vignettes), and <a href="https://cran.r-project.org/web/packages/BiocManager/index.html" class="external-link"><code>BiocManager</code></a>
(install and manage Bioconductor packages) from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"roxygen2"</span>, <span class="st">"usethis"</span>, <span class="st">"BiocManager"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Install <code>devel</code> version of Bioconductor:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"devel"</span><span class="op">)</span></span></code></pre></div>
<p>Then install the dependencies; this will also install packages that
are suggested but not imported by SFE or Voyager (i.e. soft, optional
dependencies) as well as packages required to build and test the
package; this can take a while if compiling packages from source:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install_deps.html" class="external-link">install_dev_deps</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>See <a href="https://r-pkgs.org/setup.html" class="external-link">Chapter 2 of R
Packages</a> for more details on setup.</p>
<p>If you work on anything related to <code>readXenium()</code> or the
<code>BioFormatsImage</code> class on Mac, please read the instructions
to install the optional <a href="https://github.com/aoles/RBioFormats" class="external-link"><code>RBioFormats</code></a>
package because the <code>BioFormats</code> Java library is used behind
the scene and Java needs special setup on Mac.</p>
</div>
</div>
<div class="section level2">
<h2 id="live-demo">Live demo<a class="anchor" aria-label="anchor" href="#live-demo"></a>
</h2>
<p>We will go over <a href="https://r-pkgs.org/whole-game.html" class="external-link">Chapter
1 of R Packages</a> and give some glimpses into other aspects of package
development. Some of the topics below are covered in <a href="https://adv-r.hadley.nz/techniques.html" class="external-link">the last part of the
Advanced R book</a>. Here’s the outline:</p>
<div class="section level3">
<h3 id="why-write-a-package">Why write a package?<a class="anchor" aria-label="anchor" href="#why-write-a-package"></a>
</h3>
<p>To paraphrase David Robinson, if you copy and paste the same code 3
times, then write a function. So if you need to change the code, you
only need to change it once rather than 3 times. By extension, if you
copy the same function 3 times, then write a package, so it’s easier for
you and others to reuse the function.</p>
<p>It’s also easier to install the package from CRAN, Bioconductor, or
GitHub with one line of code than to manually download the scripts and
sort through things (such as file paths) that only work on the author’s
computer. Hence writing a package is a better way to share your code.
Furthermore, R has built-in infrastructure to check the package for
problems (<code>R CMD check</code>).</p>
<p>The package can also structure analyses. In fact, this workshop
itself is an R package although there are no R functions. When functions
need to be written for a data analysis project, with a package, it’s
easier to load the functions while accounting for their interdependence.
The workshop material here is the vignettes (long form documentation).
It’s also easier to install dependencies of the required versions with
one line of code (dependencies are listed in the
<code>DESCRIPTION</code> file) and to build the workshop website with
the <a href="https://pkgdown.r-lib.org/" class="external-link"><code>pkgdown</code></a>
package designed to build package documentation websites (like the one
of Voyager).</p>
</div>
<div class="section level3">
<h3 id="structure-of-r-packages">Structure of R packages<a class="anchor" aria-label="anchor" href="#structure-of-r-packages"></a>
</h3>
<ul>
<li>
<code>DESCRIPTION</code>: Basic info about your package, including
name, version, author info, title, scription, and dependencies. Info
here is shown on the CRAN or Bioconductor landing page of the
ckage.</li>
<li>
<code>NAMESPACE</code>: Which functions from which other package
(i.e. dependency) are imported into your ckage? Which functions in your
package are exported to the user?</li>
<li>
<code>NEWS.md</code>: Which new features were implemented in which
version</li>
<li>
<code>LICENSE.md</code>: License, such as MIT, GPL, BSD, Artistic,
and etc.</li>
<li>
<code>README.md</code>: The first page you see when visiting the
GitHub repo or the documentation website of e package. It should at
least describe what the package does and how to install it, sometimes
also a ttle on how to use it as well, but it shouldn’t be too long. If
it’s too long, then it should be a gnette instead.</li>
<li>
<code>R</code>: R source code of the package</li>
<li>
<code>man</code>: Documentation files, generated automatically by
<code>roxygen2</code>, don’t edit by hand. However, ey used to be
written by hand. The syntax is similar to Latex. I greatly appreciate
<code>roxygen2</code> to ep documentation and code together and to
greatly simplify the syntax. <code>roxygen2</code> also gives warnings
en there are problems with the documentation when rendering it and
automatically writes <code>NAMESPACE</code>, ving some tedious
bookkeeping steps.</li>
<li>
<code>vignettes</code>: Long form documentation, usually
<code>Rmd</code>
</li>
<li>
<code>inst</code>: Put small example datasets and code used to
generate them here which can be used for sting or function examples.
Also put citation info here. Larger datasets should have their own
ckages. There is a size limit to software packages on Bioconductor.</li>
<li>
<code>src</code>: Code of compiled languages used in the package,
usually C and/or C++, or Fortran in some old ckages. It’s absent if
there’s only R code in the package. Since R itself is written in C and
rtran, R has native interface to C and Fortran. The <a href="https://www.rcpp.org/" class="external-link"><code>Rcpp</code></a> package streamlines
the interface between R and C++ and RStudio isn’t too bad a C++
IDE.</li>
<li>
<code>tests</code>: Unit tests</li>
<li>
<code>.Rbuildignore</code>: Files to ignore when building the R
package, such as <a href="https://github.com/features/actions" class="external-link">GitHub
tions</a> workflow files, RStudio project settings
(<code>*.Rproj</code>), and kgdown` documentation website build
files.</li>
<li>
<code>.gitignore</code>: Files to be ignored by <code>git</code>
version control, usually the <code>*.Rproj</code> file and anything
ecific to your personal R session such as R history.</li>
</ul>
</div>
<div class="section level3">
<h3 id="demo-on-toy-package">Demo on toy package<a class="anchor" aria-label="anchor" href="#demo-on-toy-package"></a>
</h3>
<ul>
<li>Load package for informal testing: shift+command+L (Mac),
control+shift+L (Windows), or <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code>
</li>
<li>Render package documentation: shift+command+D (Mac), control+shift+D
(Windows), needs setup: Tools Project Options -&gt; Build Tools -&gt;
check Generate documentation with Roxygen</li>
<li>Run all unit tests: shift+command+T (Mac), control+shift+T
(Windows)</li>
<li>“Build” and “Git” tabs in the top right pane of RStudio</li>
</ul>
</div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<ul>
<li>Imports vs. Suggests: Imported packages must be installed in order
to install your package. In contrast, suggested packages don’t have to
be installed, but your code should check whether they’re installed when
calling their functions. If your package only uses another package for a
marginal functionality, then that package should be suggested instead of
imported.</li>
<li>Try to minimize it since a broken dependency will break your
package</li>
<li>All dependencies of Biocondoctor packages must be on CRAN or
Bioconductor so they have been rev ed and tested, no GitHub only
packages</li>
<li>
<code>R CMD check</code>: automated check for problems in package
structure, code, and documentation. It also builds the vignettes and
runs all examples and unit tests. It’s on CRAN and for software packages
on Bioconductor every day.</li>
</ul>
</div>
<div class="section level3">
<h3 id="how-to-write-documentation-with-roxygen2">How to write documentation with <code>roxygen2</code><a class="anchor" aria-label="anchor" href="#how-to-write-documentation-with-roxygen2"></a>
</h3>
<ul>
<li>Users and your future self will thank you for writing documentation.
I do often look up my own cumentation.</li>
<li>I often write documentation before actually implementing the
function to help myself think through at I really want from the
function</li>
<li>Bioconductor requires you to document all arguments of all exported
functions</li>
<li>Must document output of exported functions</li>
<li>All exported functions must have examples (required by Bioconductor
but not required to pass <code>R CMD eck</code>)</li>
<li>Documenting multiple related functions on the same documentation
page</li>
<li>Build documentation website with <code>pkgdown</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="how-to-debug">How to debug<a class="anchor" aria-label="anchor" href="#how-to-debug"></a>
</h3>
<ul>
<li>Break point: Click on the space to the left of the line numbers in
RStudio after loading the package. Next time you run the code, it will
stop here and you will enter debug mode to step through the code inside
functions line by line to see what’s causing the error.</li>
<li>
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>: Similar to breakpoints, but you put it in a
line of code before the code you would like to inspect. This is helpful
when debugging <code>S4</code> methods since RStudio IDE doesn’t work
well with <code>S4</code> methods inside <code>setMethod()</code>.</li>
<li>
<code><a href="https://rdrr.io/r/base/debug.html" class="external-link">debug()</a></code>: Suppose the function
<code>plotSpatialFeature()</code> doesn’t work. Run
<code>debug(plotSpatialFeature)</code> in the R console, so next time
you call <code>plotSpatialFeature()</code>, you will enter debug mode
and step through the code. Run <code>undebug(plotSpatialFeature)</code>
if you no longer to enter debug mode when calling
<code>plotSpatialFeature()</code>.
<ul>
<li>For <code>S4</code> methods, say the
<code>SpatialFeatureExperiment</code> method of
<code>dimGeometry</code>, the <code>S4</code> class should be specified
in the <code>signature</code> argument, so you should run
<code>debug(dimGeometry, signature = "SpatialFeatureExperiment")</code>.
Same thing for <code><a href="https://rdrr.io/r/base/debug.html" class="external-link">undebug()</a></code>.</li>
</ul>
</li>
<li>
<code><a href="https://rdrr.io/r/base/traceback.html" class="external-link">traceback()</a></code>: Find the line of code that caused the most
recent error and the series of function calls that led to that line of
code.</li>
<li>
<code>options(error = recover)</code>: When you get an error, you
can enter debug mode right where the error occured. Run
<code>options(error = NULL)</code> to restore default behavior.</li>
<li>
<code>options(warn = 2)</code>: When you get a warning and wonder
where it comes from, this will convert warnings into errors so you can
use <code><a href="https://rdrr.io/r/base/traceback.html" class="external-link">traceback()</a></code> to find where the warning comes from. Run
<code>options(warn = 0)</code> to restore default behavior.</li>
</ul>
</div>
<div class="section level3">
<h3 id="why-and-how-to-write-unit-tests">Why and how to write unit tests<a class="anchor" aria-label="anchor" href="#why-and-how-to-write-unit-tests"></a>
</h3>
<ul>
<li>I use <code>testthat</code>, but there are other unit test
frameworks as well</li>
<li>Use <a href="https://vdiffr.r-lib.org/" class="external-link"><code>vdiffr</code></a> to
unit test plotting functions but it’s finicky since it requires an exact
match which often doesn’t work for <code>geom_sf()</code> which requires
geospatial systems dependencies that can lead to subtle differences
invisible to the human eye but will break <code>vdiffr</code>.</li>
<li>Code coverage: what percentage of your code is run in unit tests,
though this metric can be gamed</li>
</ul>
<p>After writing some code, we would try it to see if it works. In unit
tests, we save these informal tests so they can be run automatically.
While this may be initially time consuming and tedious, on the long run
it saves time and makes the package more stable, because when we fix a
bug, refactor code, or implement new features, we can run the existing
tests with one line of code or by clicking one button to check if the
new edits broke any existing functionalities.</p>
<p>Unit tests should test each functionality separately and each test
should be as isolated as possible so it’s easier to track down what
broke when a test fails. The isolation also forces you to write more
modular code. Only test the user facing functions so you don’t need to
change the tests every time you change the internals. When testing an
entire workflow rather than one functionality, it’s called integration
test. However, in practice, at least in R, I sometimes find myself doing
something in between unit and integration tests.</p>
<p>The tests should be performed on small datasets when possible so they
can be run quickly in the daily CRAN or Bioconductor check. If an update
in a dependency or R itself breaks you code, you are more likely to know
if you have unit tests and high test coverage. Whenever you fix a bug,
you should write a new unit test. Trying to increase code coverage
(i.e. make sure more of your code has been tested) will make you think
more carefully about how your function should behave and identify code
that is never used.</p>
<p>Finally, unit tests serve as documentation as well. In fact, example
code in SFE and Voyager function documentation is often copied from unit
tests.</p>
</div>
<div class="section level3">
<h3 id="how-to-speed-up-code-optimization">How to speed up code (optimization)<a class="anchor" aria-label="anchor" href="#how-to-speed-up-code-optimization"></a>
</h3>
<ul>
<li>“Premature optimization is the root of all evil”. Need to consider
user friendliness, readability, d maintainability. Faster != better; or
we should all analyze data in C.</li>
<li>Timing code execution (<code><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time()</a></code>, <a href="https://cran.r-project.org/web/packages/microbenchmark/index.html" class="external-link"><code>microbenchmark</code></a>,
<a href="https://bench.r-lib.org/" class="external-link"><code>bench</code></a>)</li>
<li>Avoid slow R loops with vectorization and matrix multiplication</li>
<li>Profiling with <a href="https://rstudio.github.io/profvis/" class="external-link"><code>profvis</code></a>
</li>
<li>
<code>Rcpp</code> primer (if time permits): Run
<code><a href="https://usethis.r-lib.org/reference/use_rcpp.html" class="external-link">usethis::use_rcpp()</a></code> to set up your package for
<code>Rcpp</code>. Use <code>Rcpp</code> if you really have loopy code
with thousands of iterations that can’t be vectorized or need to use a
C++ library. There are many <code>Rcpp*</code> packages that make it
easy to use those C++ libraries from R, such as
<code>RcppArmadillo</code>, <code>RcppEigen</code>, <code>BH</code>,
<code>RcppGSL</code>, and so on.</li>
<li>Speaking of the previous point but not necessarily about
optimization, check out <a href="https://rstudio.github.io/reticulate/" class="external-link"><code>reticulate</code></a>
and <a href="https://bioconductor.org/packages/release/bioc/html/basilisk.html" class="external-link"><code>basilisk</code></a>
to call Python code from R. You can have both R and Python code chunks
in Rmd or Quarto in RStudio, and you can access R objects from Python
code chunks and vice versa.</li>
</ul>
</div>
<div class="section level3">
<h3 id="other">Other<a class="anchor" aria-label="anchor" href="#other"></a>
</h3>
<p>How to do pull requests: Suppose you want to contribute to someone
else’s package. You first make a copy of that package (fork the repo),
work on your copy, and when you’re done you request the author to pull
your changes (hence it’s called “pull request”) into their original repo
so your contribution can officially become part of the package. In this
hackathon, you will do pull requests, and then we will review them
before we merge your pull requests.</p>
<p>How to submit packages to Bioconductor (if time permits)</p>
</div>
</div>
<div class="section level2">
<h2 id="voyager-vignette-guidelines">Voyager vignette guidelines<a class="anchor" aria-label="anchor" href="#voyager-vignette-guidelines"></a>
</h2>
<p>Vignettes are not in the main or devel branch, but in the
<code>documentation</code> and <code>documentation-devel</code>
branches. For the Voyager package, any vignette pull request should fork
the <code>documentation-devel</code> branch, which is for vignettes in
development. When the new vignette is ready, merge the
<code>documentation-devel</code> branch into the
<code>documentation</code> branch, which is the production version of
the Voyager documentation website. Rules of the
<code>documentation-devel</code> branch:</p>
<ul>
<li>The purpose of this branch is to make a <code>pkgdown</code> website
with longer and detailed vignettes that would make the installed size of
this package way too large to comply with Bioconductor’s 5 MB rule.</li>
<li>Don’t change anything outside the <code>vignettes</code> directory
in this branch. If the code doesn’t work, change in the
<code>main</code> or <code>devel</code> branch and merge into this
branch. This way the large vignettes won’t get into the
<code>main</code> branch and the code is kept consistent, which is
important since the <code>pkgdown</code> website also documents all the
functions of this package.</li>
<li>Exception to the previous rule: you may add packages to the Suggests
field in DESCRIPTION for extra packages used in the vignettes.</li>
<li>The file <code>vignettes/ref.bib</code> is automatically synced from
Paperpile. Don’t edit by hand.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lambda Moses, Alik Huseynov, Lior Pachter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
